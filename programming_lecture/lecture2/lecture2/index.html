<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="浙江大学竺可桢学院辅学计划站点" name="description"/>
<meta content="竺可桢学院学业指导中心" name="author"/>
<link href="https://ckc-agc.pages.zjusct.io/study-assist/programming_lecture/lecture2/lecture2/" rel="canonical"/>
<link href="../pre_class/" rel="prev"/>
<link href="../../lecture3/lecture3/" rel="next"/>
<link href="../../../graph/ckc.png" rel="icon"/>
<meta content="mkdocs-1.5.3, mkdocs-material-9.4.7" name="generator"/>
<title>类型系统与内存模型 - 浙江大学竺可桢学院辅学计划站点</title>
<link href="../../../assets/stylesheets/main.4b4a2bd9.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.356b1318.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../../css/heti.css" rel="stylesheet"/>
<link href="../../../stylesheets/neoteroi-mkdocs.css" rel="stylesheet"/>
<link href="../../../stylesheets/custom.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#_1">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="浙江大学竺可桢学院辅学计划站点" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="浙江大学竺可桢学院辅学计划站点">
<img alt="logo" src="../../../graph/ckc.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            浙江大学竺可桢学院辅学计划站点
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              类型系统与内存模型
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="indigo" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/ckc-agc/study-assist" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</div>
<div class="md-source__repository">
    浙江大学竺可桢学院辅学计划站点
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../..">
          
  
    
  
  首页

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../calculus/">
          
  
    
  
  📚微积分

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../analysis/">
          
  
    
  
  📚数学分析

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../algebra/">
          
  
    
  
  📚线性代数

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../lalu/">
          
  
    
  
  🏫线性代数：未竟之美

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../programming/">
          
  
    
  
  📚程设

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="https://slides.tonycrane.cc/PracticalSkillsTutorial/2023-fall-ckc/#/">
        
  
    
  
  🏫实用技能拾遗

      </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../../">
          
  
    
  
  🏫系统知识拾遗

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../chemistry/">
          
  
    
  
  📚普通化学

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../physics/">
          
  
    
  
  📚普通物理学

        </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="浙江大学竺可桢学院辅学计划站点" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="浙江大学竺可桢学院辅学计划站点">
<img alt="logo" src="../../../graph/ckc.png"/>
</a>
    浙江大学竺可桢学院辅学计划站点
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/ckc-agc/study-assist" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</div>
<div class="md-source__repository">
    浙江大学竺可桢学院辅学计划站点
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_1" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../..">
<span class="md-ellipsis">
    首页
  </span>
</a>
<label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_1_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
            首页
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../test/">
<span class="md-ellipsis">
    测试
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../calculus/">
<span class="md-ellipsis">
    📚微积分
  </span>
</a>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            📚微积分
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../analysis/">
<span class="md-ellipsis">
    📚数学分析
  </span>
</a>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            📚数学分析
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../analysis/2024/analysis_lecture1_sequence_limits/">
<span class="md-ellipsis">
    2023-2024学年
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../algebra/">
<span class="md-ellipsis">
    📚线性代数
  </span>
</a>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            📚线性代数
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../lalu/">
<span class="md-ellipsis">
    🏫线性代数：未竟之美
  </span>
</a>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            🏫线性代数：未竟之美
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../programming/">
<span class="md-ellipsis">
    📚程设
  </span>
</a>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            📚程设
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../programming/2024_daily_problem/">
<span class="md-ellipsis">
    每日一题
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../programming/faq/">
<span class="md-ellipsis">
    常见问题
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="https://slides.tonycrane.cc/PracticalSkillsTutorial/2023-fall-ckc/#/">
<span class="md-ellipsis">
    🏫实用技能拾遗
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_8" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../">
<span class="md-ellipsis">
    🏫系统知识拾遗
  </span>
</a>
<label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_8_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_8">
<span class="md-nav__icon md-icon"></span>
            🏫系统知识拾遗
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../lecture1/pre_class/">
<span class="md-ellipsis">
    1. 程序编译过程与调试技术
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_8_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_3" id="__nav_8_3_label" tabindex="0">
<span class="md-ellipsis">
    2. 类型系统与内存模型
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_8_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_8_3">
<span class="md-nav__icon md-icon"></span>
            2. 类型系统与内存模型
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../pre_class/">
<span class="md-ellipsis">
    课前：MAGIC 函数
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    类型系统与内存模型
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    类型系统与内存模型
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
    前置：数、进制与数据
  </a>
<nav aria-label="前置：数、进制与数据" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_3">
    如何阅读它们？
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ascii">
    ASCII
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_4">
    类型系统
  </a>
<nav aria-label="类型系统" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_5">
    计算机如何存储数据？
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_6">
    大端序与小端序
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_7">
    先来练练手！
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_8">
    基本类型
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_9">
    定长整数类型与其他整数类型
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_10">
    结构体、联合体、枚举类型
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_11">
    字符串，数组，函数，指针类型
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#void">
    void 类型
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#typedef">
    使用 typedef 为现有的类型定义别名
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_12">
    内存模型
  </a>
<nav aria-label="内存模型" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_13">
    地址和指针
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_14">
    对象和标识符
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_15">
    内存管理
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_16">
    存储期、作用域和链接
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_24">
    阅读和撰写类型声明
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../lecture3/lecture3/">
<span class="md-ellipsis">
    3. I/O 与文件
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../lecture4/lecture4/">
<span class="md-ellipsis">
    4. C 标准库
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../lecture5/lecture5/">
<span class="md-ellipsis">
    5. 数据结构与算法
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_9" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../chemistry/">
<span class="md-ellipsis">
    📚普通化学
  </span>
</a>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_9_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_9">
<span class="md-nav__icon md-icon"></span>
            📚普通化学
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_10" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../physics/">
<span class="md-ellipsis">
    📚普通物理学
  </span>
</a>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_10_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_10">
<span class="md-nav__icon md-icon"></span>
            📚普通物理学
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
    前置：数、进制与数据
  </a>
<nav aria-label="前置：数、进制与数据" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_3">
    如何阅读它们？
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ascii">
    ASCII
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_4">
    类型系统
  </a>
<nav aria-label="类型系统" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_5">
    计算机如何存储数据？
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_6">
    大端序与小端序
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_7">
    先来练练手！
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_8">
    基本类型
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_9">
    定长整数类型与其他整数类型
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_10">
    结构体、联合体、枚举类型
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_11">
    字符串，数组，函数，指针类型
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#void">
    void 类型
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#typedef">
    使用 typedef 为现有的类型定义别名
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_12">
    内存模型
  </a>
<nav aria-label="内存模型" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_13">
    地址和指针
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_14">
    对象和标识符
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_15">
    内存管理
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_16">
    存储期、作用域和链接
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_24">
    阅读和撰写类型声明
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/ckc-agc/study-assist/tree/master/docs/programming_lecture/lecture2/lecture2.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"></path></svg>
</a>
<h1 id="_1">类型系统与内存模型<a class="headerlink" href="#_1" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h1>
<!-- prettier-ignore-start -->
<div class="admonition abstract">
<p class="admonition-title">Abstract</p>
<ul>
<li>程序内存空间的布局</li>
<li><span>C<span class="heti-spacing"> </span></span>类型系统的描述</li>
<li>如何阅读声明</li>
<li>如何管理内存</li>
</ul>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>在本节讲义中，若无特别说明，我们默认采用<span class="heti-skip"><span class="heti-spacing"> </span>C99<span class="heti-spacing"> </span></span>标准。</p>
</div>
<!-- prettier-ignore-end -->
<h2 id="_2">前置：数、进制与数据<a class="headerlink" href="#_2" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<ul>
<li>十进制：<code>20231029</code></li>
<li>二进制：<code>[0b] 1001101001011001101110101</code></li>
<li>八进制：<code>[0o] 115131565</code></li>
<li>十六进制：<code>[0x] 134b375</code></li>
</ul>
<p>你可以通过 <code>%x</code> 格式化字符串来打印十六进制数。</p>
<div class="highlight"><pre><span></span><code><span class="n">printf</span><span class="p">(</span><span class="s">"%x</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="mi">20231029</span><span class="p">);</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="mh">0x20231029</span><span class="p">);</span>
</code></pre></div>
<h3 id="_3">如何阅读它们？<a class="headerlink" href="#_3" title="Permanent link">¶</a></h3>
<p>这些都是“十”：<code>0b1010</code>，<code>0o12</code>，<code>0xa</code>，<code>10</code>。</p>
<ul>
<li><code>0x18</code><ul>
<li>❌ <em>零埃克斯十八</em>，<em>零叉十八</em>，<em>零乘十八</em></li>
<li>✅ <em>零埃克斯一八</em>，<em>零叉一八</em></li>
</ul>
</li>
<li><code>0o23</code><ul>
<li>❌ <em>零欧二十三</em></li>
<li>✅ <em>零欧二三</em></li>
</ul>
</li>
<li><code>0b1010</code><ul>
<li>❌ <em>零币一千零一十</em></li>
<li>✅ <em>零币一零一零</em></li>
</ul>
</li>
<li><code>0x10000</code><ul>
<li>❌ <em>零埃克斯一万</em>，<em>零叉一万</em>，<em>零乘一万</em></li>
<li>✅ <em>零埃克斯一零零零零</em>，<em>零叉一零零零零</em></li>
</ul>
</li>
</ul>
<h3 id="ascii">ASCII<a class="headerlink" href="#ascii" title="Permanent link">¶</a></h3>
<p>每个字符对应一个数字，即其<span class="heti-skip"><span class="heti-spacing"> </span>ASCII<span class="heti-spacing"> </span></span>码。如 <code>A</code> 的<span class="heti-skip"><span class="heti-spacing"> </span>ASCII<span class="heti-spacing"> </span></span>码为 <code>65</code>，<code>a</code> 的<span class="heti-skip"><span class="heti-spacing"> </span>ASCII<span class="heti-spacing"> </span></span>码为 <code>97</code>。</p>
<h2 id="_4">类型系统<a class="headerlink" href="#_4" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<p>类型是与数据相关的属性，它决定了数据的<strong>存储方式</strong>和<strong>可进行的操作</strong>。</p>
<p>变量是数据的<strong>载体</strong>，它是<strong>存储在内存中的一块空间</strong>，有<strong>类型</strong>和<strong>值</strong>。</p>
<h3 id="_5">计算机如何存储数据？<a class="headerlink" href="#_5" title="Permanent link">¶</a></h3>
<p>在一台<span class="heti-skip"><span class="heti-spacing"> </span>s390x<span class="heti-spacing"> </span></span>架构的计算机上：</p>
<div class="highlight"><pre><span></span><code><span class="n">MAGIC_R</span><span class="p">(</span><span class="mh">0x20231029</span><span class="p">);</span>
<span class="c1">// =====</span>
<span class="c1">// 0x20231029: 4 (0x4) byte(s)</span>
<span class="c1">// 0000  20 23 10 29</span>
</code></pre></div>
<h3 id="_6">大端序与小端序<a class="headerlink" href="#_6" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<blockquote>
<p>我下面要告诉你的是，<span>Lilliput<span class="heti-spacing"> </span></span>和<span class="heti-skip"><span class="heti-spacing"> </span>Blefuscu<span class="heti-spacing"> </span></span>这两大强国在过去<span class="heti-skip"><span class="heti-spacing"> </span>36<span class="heti-spacing"> </span></span>个月里一直在苦战。战争开始是由于以下的原因：我们大家都认为，吃鸡蛋前，原始的方法是打破鸡蛋较大的一端，可是当今皇帝的祖父小时候吃鸡蛋，一次按古法打鸡蛋时碰巧将一个手指弄破了。因此他的父亲，当时的皇帝，就下了一道敕令，命令全体臣民吃鸡蛋时打破鸡蛋较小的一端，违令者重罚。老百姓们对这项命令极其反感。历史告诉我们，由此曾经发生过<span class="heti-skip"><span class="heti-spacing"> </span>6<span class="heti-spacing"> </span></span>次叛乱，其中一个皇帝送了命，另一个丢了王位。这些叛乱大多都是由<span class="heti-skip"><span class="heti-spacing"> </span>Blefuscu<span class="heti-spacing"> </span></span>的国王大臣们煽动起来的。叛乱平息后，流亡的人总是逃到那个帝国去寻求避难。据估计，先后几次有<span class="heti-skip"><span class="heti-spacing"> </span>11000<span class="heti-spacing"> </span></span>人情愿受死也不肯去打破鸡蛋较小的一端。关于这一争端，曾出版过几百本大部著作，不过大端派的书一直是受禁的，法律也规定该派任何人不得做官<heti-adjacent class="heti-adjacent-quarter">。</heti-adjacent>”</p>
<p>—— 《格列佛游记<heti-adjacent class="heti-adjacent-half">》</heti-adjacent>，<a href="https://zh.wikipedia.org/wiki/字节序"><span>https://zh.wikipedia.org/wiki/<span class="heti-spacing"> </span></span>字节序</a></p>
</blockquote>
<p>主流架构（如<span><span class="heti-spacing"> </span>x86</span>、AMD64、ARM）使用<strong>小端序</strong>。一些不常见的架构（如<span><span class="heti-spacing"> </span>SPARC</span>）使用<strong>大端序</strong>。网络协议使用<strong>大端序</strong>。</p>
<h3 id="_7">先来练练手！<a class="headerlink" href="#_7" title="Permanent link">¶</a></h3>
<p>你应当已经知道，不同类型的变量一般占据不同的字节数。</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x12345678</span><span class="p">;</span>
<span class="n">MAGIC</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>

<span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xfedcba9876543210LL</span><span class="p">;</span>
<span class="n">MAGIC</span><span class="p">(</span><span class="n">ll</span><span class="p">);</span>

<span class="kt">double</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.14159265358979323</span><span class="p">;</span>
<span class="n">MAGIC</span><span class="p">(</span><span class="n">d</span><span class="p">);</span>

<span class="kt">float</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="p">;</span>
<span class="n">MAGIC</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>

<span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">'A'</span><span class="p">;</span>
<span class="n">MAGIC</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>

<span class="n">MAGIC_R</span><span class="p">(</span><span class="sc">'A'</span><span class="p">);</span>

<span class="n">MAGIC_R</span><span class="p">((</span><span class="kt">short</span><span class="p">)</span><span class="n">ll</span><span class="p">);</span>

<span class="n">MAGIC</span><span class="p">(</span><span class="s">"Hello world! I am a l"</span><span class="w"> </span><span class="s">"ong string."</span><span class="p">);</span>
</code></pre></div>
<!-- prettier-ignore-start -->
<details class="info">
<summary>在小端序计算机上可能的运行结果</summary>
<div class="highlight"><pre><span></span><code>=====
i: 4 (0x4) byte
0000  78 56 34 12
=====
ll: 8 (0x8) byte
0000  10 32 54 76 98 ba dc fe
=====
d: 8 (0x8) byte
0000  18 2d 44 54 fb 21 09 40
=====
f: 4 (0x4) byte
0000  db 0f 49 40
=====
c: 1 (0x1) bytes
0000  41
=====
'A': 4 (0x4) byte <span class="cm">&lt;!--(1)!--&gt;</span>
0000  41 00 00 00
=====
(short)ll: 2 (0x2) byte
0000  10 32
=====
"Hello world! I am a l" "ong string.": 33 (0x21) byte
0000  48 65 6c 6c 6f 20 77 6f 72 6c 64 21 20 49 20 61
0010  6d 20 61 20 6c 6f 6e 67 20 73 74 72 69 6e 67 2e
0020  00
</code></pre></div>
<ol>
<li>其类型为 <code class="highlight"><span class="kt">int</span></code>，故占用<span class="heti-skip"><span class="heti-spacing"> </span>4<span class="heti-spacing"> </span></span>字节。</li>
</ol>
</details>
<!-- prettier-ignore-end -->
<h3 id="_8">基本类型<a class="headerlink" href="#_8" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p><a href="https://zh.cppreference.com/w/c/language/types">类型<span><span class="heti-spacing"> </span>- cppreference.com</span></a></p>
<p>整数类型：<code class="highlight"><span class="kt">char</span></code> <code class="highlight"><span class="kt">short</span></code> <code class="highlight"><span class="kt">int</span></code> <code class="highlight"><span class="kt">long</span></code> <code class="highlight"><span class="kt">long</span><span class="w"> </span><span class="kt">long</span></code></p>
<p>其中，除了 <code class="highlight"><span class="kt">char</span></code> 以外的类型默认为 <code class="highlight"><span class="kt">signed</span></code>，即有符号数。也就是说，<code class="highlight"><span class="kt">int</span></code> 就是 <code class="highlight"><span class="kt">signed</span><span class="w"> </span><span class="kt">int</span></code>。将 <code class="highlight"><span class="kt">signed</span></code> 换为 <code class="highlight"><span class="kt">unsigned</span></code>，就得到了无符号数。</p>
<!-- prettier-ignore-start -->
<div class="admonition tip">
<p class="admonition-title">那么 <code class="highlight"><span class="kt">char</span></code> 呢？</p>
<p><code class="highlight"><span class="kt">char</span></code> <code class="highlight"><span class="kt">signed</span><span class="w"> </span><span class="kt">char</span></code> <code class="highlight"><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span></code> 是<strong>三个不同的类型</strong>，尽管在大多数实现中，<code class="highlight"><span class="kt">char</span></code> 表现为有符号数。</p>
</div>
<!-- prettier-ignore-end -->
<!-- prettier-ignore-start -->
<details class="tip">
<summary>字符类型解惑</summary>
<p>或许你会和我同样对以下几个问题感到困惑：</p>
<ul>
<li>为什么<strong>字符常量</strong>的类型是 <code class="highlight"><span class="kt">int</span></code> 且长度是<span class="heti-skip"><span class="heti-spacing"> </span>4<span class="heti-spacing"> </span></span>个字节？</li>
<li>为什么 <code class="highlight"><span class="n">getchar</span><span class="p">()</span></code> 等函数返回 <code class="highlight"><span class="kt">int</span></code> 而不是 <code class="highlight"><span class="kt">char</span></code>？</li>
<li>宽字符、多字节字符和<span class="heti-skip"><span class="heti-spacing"> </span>Unicode<span class="heti-spacing"> </span></span>究竟如何使用？</li>
</ul>
<p>这里将解释前两个问题，第三个问题不做要求，有兴趣可以参看中的相关内容。</p>
<ul>
<li>字符常量的类型为什么是 <code class="highlight"><span class="kt">int</span></code>？</li>
</ul>
<p>多字符常量（Multicharacter constants）继承于<span class="heti-skip"><span class="heti-spacing"> </span>C<span class="heti-spacing"> </span></span>语言的前身<span class="heti-skip"><span class="heti-spacing"> </span>B<span class="heti-spacing"> </span></span>语言。它们的主要用途是用于编写汇编语言，因为汇编语言中的指令通常是多字节的。例如，<code class="highlight"><span class="err">'</span><span class="n">abcd</span><span class="err">'</span></code> 可以用于表示一个<span class="heti-skip"><span class="heti-spacing"> </span>32<span class="heti-spacing"> </span></span>位的指令。</p>
<p>在<span class="heti-skip"><span class="heti-spacing"> </span>C<span class="heti-spacing"> </span></span>标准中，<strong>多字符常量被定义为 <code class="highlight"><span class="kt">int</span></code> 类型</strong>，长度是<span class="heti-skip"><span class="heti-spacing"> </span>4<span class="heti-spacing"> </span></span>个字节。在<span class="heti-skip"><span class="heti-spacing"> </span>C<span class="heti-spacing"> </span></span>语言的实际使用中，多字符常量通常是出于<strong>调试目的</strong>而嵌入结构中的<strong>魔数（Magic Numbers）</strong>，就像有些人会使用 <code class="highlight"><span class="mh">0xfeedbeef</span></code> 和 <code class="highlight"><span class="mh">0xdeadbeef</span></code> 而不是 <code class="highlight"><span class="nb">NULL</span></code> 来标记指针的<strong>未初始化</strong>和<strong>已删除</strong>状态。这样做的好处是，如果程序出现了错误，我们可以通过打印出这些魔数来定位错误的位置。</p>
<p>我们使用时<strong>应当避免将多字符常量从 <code class="highlight"><span class="kt">int</span></code> 类型转换为 <code class="highlight"><span class="kt">char</span></code> 类型，因为这一转换过程是由编译器实现决定的。</strong>比如 <code class="highlight"><span class="kt">char</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">'</span><span class="n">ABCD</span><span class="err">'</span></code>，在<span><span class="heti-spacing"> </span>gcc</span>、clang、<span>msvc<span class="heti-spacing"> </span></span>上均为 <code class="highlight"><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">'D'</span></code>，但是在<span class="heti-skip"><span class="heti-spacing"> </span>armcc<span class="heti-spacing"> </span></span>上为 <code class="highlight"><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">'A'</span></code>。</p>
<ul>
<li><code class="highlight"><span class="n">getchar</span><span class="p">()</span></code> 为什么要返回 <code class="highlight"><span class="kt">int</span></code> 类型？</li>
</ul>
<p>因为它会返回 <code>EOF</code>，而 <code>EOF</code> 在标准中定义为 <code class="highlight"><span class="kt">int</span></code> 类型，通常为 <code class="highlight"><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="mi">-1</span></code>。</p>
<blockquote>
<p>This macro is an integer value that is returned by a number of narrow stream functions to indicate an end-of-file condition, or some other error situation.</p>
</blockquote>
<p>为什么要这么定义？从逻辑上说，<code>EOF</code> 应当<strong>与任何一个字符值都不同</strong>。<code class="highlight"><span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="mi">-1</span></code> 也是一个合法的字符（因为它是 <code class="highlight"><span class="kt">char</span></code> 类型，根据<span class="heti-skip"><span class="heti-spacing"> </span>Latin-1<span class="heti-spacing"> </span></span>编码，<code class="highlight"><span class="kt">char</span></code> 类型的每个可能值都表示一个字符<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，所以不能用作 <code>EOF</code>，必须使用 <code class="highlight"><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="mi">-1</span></code>，它与前者宽度不同，因此是不同的值。</p>
<p>还记得的在类型转换中提到的<strong>整形提升</strong>吗？如果我们让 <code class="highlight"><span class="n">getchar</span><span class="p">()</span></code> 返回 <code class="highlight"><span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="mi">-1</span></code>，当函数接收到 <code class="highlight"><span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="mi">-1</span></code> 时，它会执行从无符号数到有符号数的转换（即使实现为有符号的 <code class="highlight"><span class="kt">char</span></code><heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，从而返回 <code class="highlight"><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="mi">255</span></code>，这与 <code>EOF</code> 的定义不符。</p>
<blockquote>
<p>参考资料：</p>
<ul>
<li><a href="https://www.quora.com/What-is-the-purpose-of-multi-character-constants-in-C">What is the purpose of multi character constants in C? - Quora</a></li>
<li><a href="https://zh.cppreference.com/w/c/language/character_constant">字符常量<span><span class="heti-spacing"> </span>- cppreference.com</span></a></li>
<li><a href="https://www.reddit.com/r/C_Programming/comments/5a9sv1/int_c_getchar_why_int"><code class="highlight"><span class="kt">int</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getchar</span><span class="p">()</span></code>? Why <code class="highlight"><span class="kt">int</span></code>? : C_Programming (reddit.com)</a></li>
<li><a href="https://zh.cppreference.com/w/c/language/conversion">隐式转换<span><span class="heti-spacing"> </span>- cppreference.com</span></a></li>
</ul>
</blockquote>
</details>
<!-- prettier-ignore-end -->
<p>浮点类型：<code class="highlight"><span class="kt">float</span></code> <code class="highlight"><span class="kt">double</span></code> <code class="highlight"><span class="kt">long</span><span class="w"> </span><span class="kt">double</span></code></p>
<div class="admonition tip">
<p class="admonition-title">复数类型</p>
<p>在其后加上 <code class="highlight"><span class="kt">_Complex</span></code> 即为复数类型，如 <code class="highlight"><span class="kt">double</span><span class="w"> </span><span class="kt">_Complex</span></code>。相同的，有 <code class="highlight"><span class="k">_Imaginary</span></code>。</p>
<p>是的，<span>C<span class="heti-spacing"> </span></span>在语言层面上支持复数和虚数，但并不是所有的编译器都支持这一特性。例如，<span>gcc<span class="heti-spacing"> </span></span>和<span class="heti-skip"><span class="heti-spacing"> </span>clang<span class="heti-spacing"> </span></span>目前均不支持 <code class="highlight"><span class="k">_Imaginary</span></code>。</p>
</div>
<h3 id="_9">定长整数类型与其他整数类型<a class="headerlink" href="#_9" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>在 <code>stdint.h</code> 中定义，如 <code class="highlight"><span class="kt">int8_t</span></code> <code class="highlight"><span class="kt">uint8_t</span></code> <code class="highlight"><span class="kt">int16_t</span></code> <code class="highlight"><span class="kt">uint16_t</span></code> <code class="highlight"><span class="kt">int32_t</span></code> <code class="highlight"><span class="kt">uint32_t</span></code> <code class="highlight"><span class="kt">int64_t</span></code> <code class="highlight"><span class="kt">uint64_t</span></code>。</p>
<p><code class="highlight"><span class="k">sizeof</span></code> 运算符与 <code class="highlight"><span class="n">offsetof</span></code> 宏的结果：<code class="highlight"><span class="kt">size_t</span></code>，足够表示任何对象的<strong>大小</strong>。常被定义为 <code class="highlight"><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span></code>。</p>
<p>在 <code>stddef.h</code> 中定义，<code class="highlight"><span class="kt">ptrdiff_t</span></code> 表示两个指针相减的结果。常被定义为 <code class="highlight"><span class="kt">long</span></code>。</p>
<!-- prettier-ignore-start -->
<details class="tip">
<summary>如何输出这些整数类型？</summary>
<p>在 <code>inttypes.h</code> 中定义了一系列格式化字符串，如 <code>PRId32</code> 一般展开为 <code class="highlight"><span class="s">"d"</span></code>，而 <code>PRIu64</code> 可能展开为 <code class="highlight"><span class="s">"llu"</span></code>。</p>
<p>这些定义在不同的平台上可能有所不同。使用这些格式化字符串可以保证在不同平台上输出正确的结果（且不会引发编译器警告<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>。</p>
<div class="highlight"><pre><span></span><code><span class="kt">uint64_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xdeadbeefcafebabe</span><span class="p">;</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"%"</span><span class="w"> </span><span class="n">PRIu64</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span><span class="w"> </span><span class="c1">// 应当包含 inttypes.h</span>
</code></pre></div>
<p>对于 <code class="highlight"><span class="kt">size_t</span></code> 和 <code class="highlight"><span class="kt">ptrdiff_t</span></code>，可以使用 <code class="highlight"><span class="o">%</span><span class="n">zu</span></code> 和 <code class="highlight"><span class="o">%</span><span class="n">td</span></code>。</p>
</details>
<!-- prettier-ignore-end -->
<h3 id="_10">结构体、联合体、枚举类型<a class="headerlink" href="#_10" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>枚举类型实质上是整数类型。它的值是由编译器自动分配的（一般从<span class="heti-skip"><span class="heti-spacing"> </span>0<span class="heti-spacing"> </span></span>开始<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，也可手动指定。</p>
<p>结构体的大小是其成员大小的总和，加上<strong>对齐</strong>所需的填充字节。</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">point</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">  </span><span class="kt">long</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">point</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1234</span><span class="p">,</span><span class="w"> </span><span class="mi">-5678</span><span class="p">};</span>
<span class="n">MAGIC</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

<span class="k">union</span><span class="w"> </span><span class="nc">un_t</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">long</span><span class="w"> </span><span class="n">l</span><span class="p">;</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">d</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">union</span><span class="w"> </span><span class="nc">un_t</span><span class="w"> </span><span class="n">un</span><span class="p">;</span>
<span class="n">un</span><span class="p">.</span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.14159265358979323</span><span class="p">;</span>
<span class="n">MAGIC</span><span class="p">(</span><span class="n">un</span><span class="p">);</span>

<span class="k">enum</span><span class="w"> </span><span class="n">en_t</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">ENA</span><span class="p">,</span><span class="w"> </span><span class="n">ENB</span><span class="p">,</span><span class="w"> </span><span class="n">ENC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">114514</span><span class="w"> </span><span class="p">};</span>
<span class="n">MAGIC_R</span><span class="p">(</span><span class="n">ENA</span><span class="p">);</span>
<span class="n">MAGIC_R</span><span class="p">(</span><span class="n">ENC</span><span class="p">);</span>

<span class="n">MAGIC_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
<span class="n">MAGIC_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
<span class="n">MAGIC_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="n">un</span><span class="p">.</span><span class="n">l</span><span class="p">);</span>
<span class="n">MAGIC_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="n">un</span><span class="p">.</span><span class="n">d</span><span class="p">);</span>
</code></pre></div>
<!-- prettier-ignore-start -->
<details class="info">
<summary>在小端序计算机上可能的运行结果</summary>
<div class="highlight"><pre><span></span><code>=====
p: 16 (0x10) byte
0000  d2 04 00 00 00 00 00 00 d2 e9 ff ff ff ff ff ff
=====
un: 8 (0x8) byte
0000  18 2d 44 54 fb 21 09 40
=====
ENA: 4 (0x4) bytes
0000  00 00 00 00
=====
ENC: 4 (0x4) bytes
0000  52 bf 01 00
&amp;p.x: 0x16d3cee18
&amp;p.y: 0x16d3cee20
&amp;un.l: 0x16d3cee10
&amp;un.d: 0x16d3cee10
</code></pre></div>
</details>
<!-- prettier-ignore-end -->
<h3 id="_11">字符串，数组，函数，指针类型<a class="headerlink" href="#_11" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>数组是一系列相同类型的对象的集合。数组的大小是其元素大小的总和。</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="n">arr</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mh">0xbeef</span><span class="p">,</span><span class="w"> </span><span class="mh">0xcafe</span><span class="p">,</span><span class="w"> </span><span class="mh">0xdead</span><span class="p">,</span><span class="w"> </span><span class="mh">0xface</span><span class="p">,</span><span class="w"> </span><span class="mh">0xfeed</span><span class="w"> </span><span class="p">};</span>
<span class="n">MAGIC</span><span class="p">(</span><span class="n">arr</span><span class="p">);</span>

<span class="kt">char</span><span class="w"> </span><span class="n">str1</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Hello world!"</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">str2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Hello world!"</span><span class="p">;</span>
<span class="n">MAGIC</span><span class="p">(</span><span class="n">str1</span><span class="p">);</span>
<span class="n">MAGIC</span><span class="p">(</span><span class="n">str2</span><span class="p">);</span>
</code></pre></div>
<p>以 <code>main</code> 函数为例，其有两种（标准规定的）形式：
</p><div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span><span class="w">                   </span><span class="c1">// 类型为 int(void)</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[]);</span><span class="w"> </span><span class="c1">// 类型为 int(int, char *[])</span>
</code></pre></div>
<p><span>C<span class="heti-spacing"> </span></span>标准不允许对函数类型应用 <code>sizeof</code> 运算符。</p>
<p>所有的指针类型都拥有相同的大小。我们将在后面的章节中讨论指针类型。</p>
<div class="admonition note">
<p class="admonition-title">数组到指针退化</p>
</div>
<h3 id="void"><code class="highlight"><span class="kt">void</span></code> 类型<a class="headerlink" href="#void" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p><code class="highlight"><span class="kt">void</span></code> 是一个<strong>不完整类型</strong>，即不存在 <code class="highlight"><span class="kt">void</span></code> 类型的变量。它作为函数的返回类型，表示函数没有返回值。它作为函数的参数类型，表示函数不接受参数。</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* 实现略去 */</span><span class="w"> </span><span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">g</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">f</span><span class="p">();</span><span class="w"> </span><span class="c1">// 仅当 f 的返回类型为 void 时才能这样写</span>
<span class="p">}</span>
</code></pre></div>
<!-- prettier-ignore-start -->
<details class="info">
<summary>那么 <code class="highlight"><span class="kt">void</span><span class="w"> </span><span class="o">*</span></code> 呢？</summary>
<p><code class="highlight"><span class="kt">void</span><span class="w"> </span><span class="o">*</span></code> 是一个<strong>完整类型</strong>，它表示一个指针，指向未知类型的对象（即<heti-adjacent class="heti-adjacent-quarter">，</heti-adjacent>“舍弃”了类型信息的指针<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>。</p>
<p>任何类型的指针均可隐式转换为 <code class="highlight"><span class="kt">void</span><span class="w"> </span><span class="o">*</span></code> 类型，但是反过来不行。这是因为 <code class="highlight"><span class="kt">void</span><span class="w"> </span><span class="o">*</span></code> 类型的指针不知道指向的对象的大小，因此不能进行解引用操作。</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x12345678</span><span class="p">;</span>
<span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i</span><span class="p">;</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"%p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">p</span><span class="p">);</span>
</code></pre></div>
</details>
<!-- prettier-ignore-end -->
<!-- prettier-ignore-start -->
<details class="tip">
<summary>什么是不完整类型？</summary>
<p><strong>不完整类型</strong>是指<strong>只知道其存在，但无法知道其大小</strong>的类型。比如：</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">incomp</span><span class="p">;</span>
</code></pre></div>
<p>我们只知道 <code class="highlight"><span class="k">struct</span><span class="w"> </span><span class="nc">incomp</span></code> 存在，但是不知道它的大小（因为没有给出其定义<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>。因此，<code class="highlight"><span class="k">struct</span><span class="w"> </span><span class="nc">incomp</span></code> 是一个<strong>不完整类型</strong>。但是可以声明指向 <code class="highlight"><span class="k">struct</span><span class="w"> </span><span class="nc">incomp</span></code> 类型的指针。</p>
<p><strong><code class="highlight"><span class="kt">void</span></code> 类型是唯一可作为函数返回类型的不完整类型。</strong>这是<span class="heti-skip"><span class="heti-spacing"> </span>C<span class="heti-spacing"> </span></span>语法的一条特殊规定，其意义就是标定“函数没有返回值”。</p>
</details>
<!-- prettier-ignore-end -->
<h3 id="typedef">使用 <code class="highlight"><span class="k">typedef</span></code> 为现有的类型定义别名<a class="headerlink" href="#typedef" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
</code></pre></div>
<p>你已经很熟悉这样的声明了，对吧？<code>a</code> 是一个 <code class="highlight"><span class="kt">int</span></code> 类型的变量。</p>
<div class="highlight"><pre><span></span><code><span class="k">typedef</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
</code></pre></div>
<p>这就是说，<code>a</code> 现在就是 <code class="highlight"><span class="kt">int</span></code> 的别名。你可以这样使用它：</p>
<div class="highlight"><pre><span></span><code><span class="n">a</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"> </span><span class="c1">// 等价于 int b;</span>
</code></pre></div>
<p>我们之前提到过的 <code class="highlight"><span class="kt">size_t</span></code>、<code class="highlight"><span class="kt">ptrdiff_t</span></code>、<code class="highlight"><span class="kt">int8_t</span></code> 等类型，就是通过 <code class="highlight"><span class="k">typedef</span></code> 定义的。</p>
<p>考试中还会要求你阅读代码片段，为形参等位置填写类型声明。请参考历年卷总结中的例题。</p>
<!-- prettier-ignore-start -->
<div class="admonition info">
<p class="admonition-title"><span>C<span class="heti-spacing"> </span></span>与<span class="heti-skip"><span class="heti-spacing"> </span>C++<span class="heti-spacing"> </span></span>的 <code class="highlight"><span class="k">struct</span></code> 并不完全一致</p>
<p>对于结构体</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">point</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>在<span class="heti-skip"><span class="heti-spacing"> </span>C++<span class="heti-spacing"> </span></span>中，此声明引入的新类型名为 <code>point</code>，而在<span class="heti-skip"><span class="heti-spacing"> </span>C<span class="heti-spacing"> </span></span>中，此声明引入的新类型名为 <code class="highlight"><span class="k">struct</span><span class="w"> </span><span class="nc">point</span></code>。<code>point</code> 本身不是一个类型名。</p>
<p>下面的写法是常见的：</p>
<div class="highlight"><pre><span></span><code><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">point</span><span class="w"> </span><span class="n">point</span><span class="p">;</span>
</code></pre></div>
<p>此即定义了一个类型名 <code>point</code>，其为 <code class="highlight"><span class="k">struct</span><span class="w"> </span><span class="nc">point</span></code> 的别名。</p>
</div>
<!-- prettier-ignore-end -->
<h2 id="_12">内存模型<a class="headerlink" href="#_12" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<p>在<span class="heti-skip"><span class="heti-spacing"> </span>C<span class="heti-spacing"> </span></span>语言的内存模型中，<strong>字节</strong>（byte）是最小的可寻址的内存单元，其被定义为一系列连续的<strong>位</strong>（bit<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>。<strong>可寻址</strong>意味着每个字节都拥有其编号，即<strong>地址</strong>。</p>
<div class="highlight"><pre><span></span><code>MAGIC_PTR(&amp;i);
MAGIC_PTR(&amp;ll);
MAGIC_PTR(&amp;d);
MAGIC_PTR(&amp;f);

MAGIC_SIZED(f, 0x20);
</code></pre></div>
<h3 id="_13">地址和指针<a class="headerlink" href="#_13" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p><strong>地址</strong>是一个<strong>无符号整数</strong>，它表示内存中的一个字节。<strong>指针</strong>是一个<strong>变量</strong>，其存储了一个地址。由于这个原因，所有指针类型的大小都是相同的。</p>
<div class="highlight"><pre><span></span><code><span class="n">MAGIC_R</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i</span><span class="p">);</span>
<span class="n">MAGIC_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i</span><span class="p">);</span>
</code></pre></div>
<h3 id="_14">对象和标识符<a class="headerlink" href="#_14" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>每个被存储的值都占用一定的物理内存，这样的一块内存称为<strong>对象</strong>。对象可以储存一个或多个值。声明变量时，创建了一个<strong>标识符</strong>（identifier<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，其与对象相关联。</p>
<p>所以，定义一个变量时实际上做了两件事：
- 为对象分配内存
- 将标识符与对象关联</p>
<!-- prettier-ignore-start -->
<div class="admonition tip">
<p class="admonition-title">对象的其他含义</p>
<p>“面向对象编程”中的对象指的是“类对象”。<span>C<span class="heti-spacing"> </span></span>语言中没有“类对象”这一概念。</p>
</div>
<!-- prettier-ignore-end -->
<p>思维训练：</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">psi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i</span><span class="p">;</span>

<span class="n">MAGIC</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="n">MAGIC_R</span><span class="p">(</span><span class="o">*</span><span class="n">psi</span><span class="p">);</span>
<span class="n">MAGIC</span><span class="p">(</span><span class="n">psi</span><span class="p">);</span>
<span class="n">MAGIC_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i</span><span class="p">);</span>
<span class="n">MAGIC_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="n">psi</span><span class="p">);</span>
</code></pre></div>
<!-- prettier-ignore-start -->
<details class="info">
<summary>在小端序计算机上可能的运行结果</summary>
<div class="highlight"><pre><span></span><code>=====
i: 4 (0x4) bytes
<span class="hll">0000  78 56 34 12
</span>=====
*psi: 4 (0x4) bytes
<span class="hll">0000  78 56 34 12
</span>=====
<span class="hll">psi: 8 (0x8) bytes
</span><span class="hll">0000  4c ae db 6f 01 00 00 00
</span><span class="hll">&amp;i: 0x16fdbae4c
</span>&amp;psi: 0x16fdbae08
</code></pre></div>
</details>
<!-- prettier-ignore-end -->
<p>我们可以观察到什么？</p>
<ul>
<li><code>psi</code> 变量的值就是 <code>i</code> 关联的对象的地址（<code>0x16fdbae4c</code>）</li>
<li>通过 <code>psi</code> 可以访问 <code>i</code> 关联的对象（<code>*psi</code>）</li>
<li><code>psi</code> 本身作为一个变量，也有自己的地址（<code>0x16fdbae08</code>）</li>
</ul>
<!-- prettier-ignore-start -->
<div class="admonition note">
<p class="admonition-title">左值与右值</p>
<p>指代对象的表达式被称为<strong>左值</strong>。这个术语来自于赋值语句，因为赋值语句的左边必须是一个对象。</p>
<p>如果可以使用左值改变对象中的值，那么称为<strong>可修改的左值</strong>。</p>
<ul>
<li><code>i</code> 是标识符，是可修改的左值</li>
<li><code>*psi</code> 或 <code>arr[3]</code> 是表达式，是可修改的左值</li>
<li><code>2 * i</code> 或 <code>&amp;i</code> 或 <code>&amp;psi</code>，不是标识符，是右值</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">pc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Good morning my neighbors"</span><span class="p">;</span>
</code></pre></div>
<ul>
<li><code>pc</code> 是可修改的左值</li>
<li><code>*pc</code> 是不可修改的左值</li>
</ul>
<p>参考：<a href="https://zh.cppreference.com/w/c/language/value_category">值类别<span><span class="heti-spacing"> </span>- cppreference.com</span></a></p>
</div>
<!-- prettier-ignore-end -->
<h3 id="_15">内存管理<a class="headerlink" href="#_15" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p><span>C<span class="heti-spacing"> </span></span>的内存管理是一大痛点，因为它本身并不提供检查机制，一切都依赖于程序员自己。因此，好好掌握内存管理对于写出安全、稳定的程序是非常必要的。</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="nf">dangling</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xdeadbeef</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">pfi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dangling</span><span class="p">();</span>
<span class="w">  </span><span class="n">MAGIC</span><span class="p">(</span><span class="n">pfi</span><span class="p">);</span>
<span class="w">  </span><span class="n">MAGIC</span><span class="p">(</span><span class="o">*</span><span class="n">pfi</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>在这里 <code>pfi</code> 称为<strong>悬垂指针</strong>（dangling pointer<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，它指向了一个已经被销毁的对象。使用悬垂指针是未定义行为，可能会导致程序崩溃。</p>
<!-- prettier-ignore-start -->
<div class="admonition note">
<p class="admonition-title">常见变式</p>
<div class="highlight"><pre><span></span><code><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="nf">get_a_string</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">str</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Hello world!"</span><span class="p">;</span>
</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">str</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_a_string</span><span class="p">();</span>
<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">str</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>问题出在哪？</p>
<p><code>str</code> 作为一个数组，其生命周期在 <code>get_a_string</code> 函数返回时结束。</p>
<p>它与下面的程序有什么区别？</p>
<div class="highlight"><pre><span></span><code><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="nf">get_a_string</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Hello world!"</span><span class="p">;</span>
</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">str</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_a_string</span><span class="p">();</span>
<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">str</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>
<!-- prettier-ignore-end -->
<hr/>
<h3 id="_16">存储期、作用域和链接<a class="headerlink" href="#_16" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p><strong>存储期</strong>描述对象，表明在内存中存储的时间。</p>
<p><strong>作用域和链接性</strong>描述标识符，表明程序的哪些部分可以使用它。</p>
<h4 id="_17">存储期<a class="headerlink" href="#_17" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ul>
<li>静态存储期（static）
  在程序开始时创建，在程序结束时销毁。如全局变量和静态变量。</li>
<li>自动存储期（automatic）
  在程序进入作用域时创建，在程序离开作用域时销毁。如局部变量。</li>
<li>动态分配存储期（allocated）
  在程序显式地分配内存时创建，在程序显式地释放内存时销毁。如 <code class="highlight"><span class="n">malloc</span><span class="p">()</span></code> 分配的内存。</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">global</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">automatic</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">allocated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>

<span class="w">  </span><span class="n">MAGIC_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="n">global</span><span class="p">);</span>
<span class="w">  </span><span class="n">MAGIC_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="n">automatic</span><span class="p">);</span>
<span class="w">  </span><span class="n">MAGIC_PTR</span><span class="p">(</span><span class="n">allocated</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="_18">作用域<a class="headerlink" href="#_18" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<p><a href="https://zh.cppreference.com/w/c/language/scope">作用域<span><span class="heti-spacing"> </span>- cppreference.com</span></a></p>
<h5 id="_19">块作用域<a class="headerlink" href="#_19" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h5>
<!-- prettier-ignore-start -->
<details class="note">
<summary>Note</summary>
<p>在<span class="heti-skip"><span class="heti-spacing"> </span>C99<span class="heti-spacing"> </span></span>之前，块作用域的变量必须在块的开头声明。</p>
<p>在<span><span class="heti-spacing"> </span>C99</span>，<strong>块</strong>的概念被放宽：控制语句（条件、循环）也是块（即使没有使用花括号<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>。比如：</p>
<div class="highlight"><pre><span></span><code><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;;)</span>
<span class="w">  </span><span class="n">function</span><span class="p">();</span>
</code></pre></div>
<p><code>i</code> 具有块作用域，是循环的一部分。</p>
<p>更精细的定义：循环体是整个循环的子块。你可以这样想它：</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;;)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>上面的两个同名变量 <code>i</code> 不在同一个块中，因此不是重复定义。</p>
</details>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>同名的变量，内部覆盖外部。</p>
</div>
<!-- prettier-ignore-end -->
<h5 id="_20">函数作用域<a class="headerlink" href="#_20" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h5>
<p><code>goto</code> 语句的标签。这意味着，即使标签在内层的块中，它的作用域也延伸至整个函数。</p>
<h5 id="_21">函数原型作用域<a class="headerlink" href="#_21" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h5>
<p>函数原型中的变量名。从定义处到函数原型结束。</p>
<p>只在你使用<span class="heti-skip"><span class="heti-spacing"> </span>VLA<span class="heti-spacing"> </span></span>时需要注意这一顺序：</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">use_VLA</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">ar</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">m</span><span class="p">]);</span>
</code></pre></div>
<h5 id="_22">文件作用域<a class="headerlink" href="#_22" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h5>
<p>在任何函数外定义的变量。从定义处到文件末尾。</p>
<p>这样的变量称为全局变量。</p>
<!-- prettier-ignore-start -->
<div class="admonition note">
<p class="admonition-title">翻译单元</p>
<p>你所认为的多个文件对于编译器来说可能是一个文件。比如头文件：预处理时，头文件被插入。对于编译器来说，它看到的是单个文件。</p>
<p>这样的单个文件称为一个翻译单元。每个翻译单元对应一个源文件和它<span class="heti-skip"><span class="heti-spacing"> </span>include<span class="heti-spacing"> </span></span>的文件。</p>
<p>刚才我们说的<strong>文件作用域</strong>其实是在<strong>整个翻译单元可见</strong>。</p>
</div>
<!-- prettier-ignore-end -->
<hr/>
<p>由于讲义中涉及到的内容较多，无法在一节课内全部讲解。后续的讲义将会随回放链接更新而更新。</p>
<h4 id="_23">链接<a class="headerlink" href="#_23" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<h3 id="_24">阅读和撰写类型声明<a class="headerlink" href="#_24" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<hr/>
<div class="md-source-file">
<small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">October 29, 2023</span>
</small>
</div>
</article>
</div>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": ["search.highlight", "navigation.tracking", "navigation.tabs", "navigation.prune", "navigation.indexes", "navigation.top", "header.autohide", "content.code.copy", "content.code.annotate", "content.action.edit"], "search": "../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../../assets/javascripts/bundle.aecac24b.min.js"></script>
<script src="../../../javascripts/mathjax.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="https://jsd.onmicrosoft.cn/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>